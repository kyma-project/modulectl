version: "2"
linters:
  default: all
  disable:
    - contextcheck # too many false positives
    - depguard # checks if package imports are whitelisted
    - exhaustruct # too subjective and harms code readability
    - nlreturn # too strict and mostly code is not more readable
    - paralleltest # should be enabled consciously for long running tests
    - lll # revive.line-length-limit serve same purpose
    - sqlclosecheck # not needed for this project
    - wsl # too strict and mostly code is not more readable
    - wsl_v5 # too strict
    - noinlineerr # we want to keep inlining
  settings:
    forbidigo:
      # Forbid the following identifiers (list of regexp).
      # Default: ["^(fmt\\.Print(|f|ln)|print|println)$"]
      forbid:
        # Built-in bootstrapping functions.
        - pattern: ^fmt\.Print\(
          msg: "use fmt.Println instead of fmt.Print if console output is needed"
    cyclop:
      max-complexity: 20
    funlen:
      lines: 80
      statements: 50
      ignore-comments: true
    importas:
      alias:
        - pkg: github.com/kyma-project/modulectl/tools/io
          alias: iotools
        - pkg: github.com/kyma-project/modulectl/internal/common/errors
          alias: commonerrors
        - pkg: github.com/kyma-project/modulectl/cmd/modulectl/scaffold
          alias: scaffoldcmd
        - pkg: github.com/kyma-project/modulectl/cmd/modulectl/create
          alias: createcmd
        - pkg: github.com/kyma-project/modulectl/internal/service/moduleconfig/generator
          alias: moduleconfiggenerator
        - pkg: github.com/kyma-project/modulectl/internal/service/moduleconfig/reader
          alias: moduleconfigreader
        - pkg: ocm.software/ocm/api/ocm/compdesc/meta/v1
          alias: ocmv1
        - pkg: ocm.software/ocm/cmds/ocm/commands/ocmcmds/common/inputs/types/ociartifact
          alias: ociartifacttypes
        - pkg: k8s.io/apimachinery/pkg/apis/meta/v1
          alias: metav1
        - pkg: k8s.io/api/apps/v1
          alias: appsv1
        - pkg: k8s.io/api/core/v1
          alias: corev1
        - pkg: github.com/mandelsoft/goutils/errors
          alias: mandelsofterrors
      no-unaliased: true
      no-extra-aliases: true
    ireturn:
      allow:
        - anon
        - error
        - empty
        - stdlib
        - vfs.FileSystem
        - vfs.File
        - internal.BlobAccess
        - internal.ComponentVersionAccess
        - internal.Credentials
        - internal.Repository
        - cpi.BlobAccess
        - cpi.ComponentVersionAccess
        - credentials.Credentials
        - cpi.Repository
    nestif:
      min-complexity: 6
    nolintlint:
      require-explanation: true
    revive:
      severity: error
      rules:
        - name: comment-spacings
          disabled: true
        - name: dot-imports
          severity: warning
          disabled: true
        - name: line-length-limit
          arguments:
            - 120
          severity: warning
    varnamelen:
      ignore-names:
        - ok
      ignore-type-assert-ok: true
      ignore-map-index-ok: true
      ignore-chan-recv-ok: true
  exclusions:
    generated: lax
    presets:
      - comments
      - common-false-positives
      - legacy
      - std-error-handling
    rules:
      - linters:
          - dupl
          - err113
          - funlen
          - gochecknoglobals
          - goconst
          - maintidx
          - nilnil #valid scenario in tests
          - varnamelen
          - wrapcheck
        path: _test\.go
      - linters:
          - importas
        text: has alias "" which is not part of config
      - linters:
          - staticcheck
        text: "SA1019:.*comparch.ComponentArchive"
      - linters:
          - staticcheck
        text: "SA1019:.*comparch.New"
      - linters:
          - staticcheck
        text: "QF1012: Use fmt.Fprintf"
      - linters:
          - lll
        source: "^// http "
    paths:
      - third_party$
      - builtin$
      - examples$
issues:
  max-issues-per-linter: 0
  max-same-issues: 0
formatters:
  enable:
    - gci
    - gofmt
    - gofumpt
    - goimports
  settings:
    gci:
      sections:
        - standard
        - default
        - prefix(github.com/kyma-project/modulectl)
        - blank
        - dot
      custom-order: true
  exclusions:
    generated: lax
    paths:
      - third_party$
      - builtin$
      - examples$
      - tests/e2e/
